<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciclo Feminino - Calendário Menstrual</title>
    <!-- Carrega Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #ec4899; /* Rosa principal (Pink 500) */
            --color-fertile: #38bdf8; /* Ciano (Sky 400) */
            --color-period: #ef4444;  /* Vermelho (Red 500) */
            --color-ovulation: #10b981; /* Verde (Emerald 500) */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fce7f6; /* Fundo Rosa Claro */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
        }

        .card {
            background-color: white;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            max-width: 900px;
            width: 100%;
        }

        /* Estilos do Calendário */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .day-header {
            text-align: center;
            padding: 8px 4px;
            font-weight: 700;
            color: #9c0c66; /* Rosa Escuro */
            font-size: 0.8rem;
        }
        
        .day-cell {
            height: 70px; /* Altura fixa para celular */
            padding: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            border: 1px solid #fbcfe8; /* Borda suave */
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .day-cell:hover:not(.empty-day):not(.current-month-false) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .day-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: #374151;
            z-index: 10;
        }

        .day-cell.current-month-false {
            background-color: #fcfcfc;
            color: #d1d5db;
        }

        .empty-day {
            background-color: #f9fafb;
            border: none;
            cursor: default;
        }

        /* Indicadores de Fase */
        .indicator {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            z-index: 10;
        }

        .period-day .indicator { background-color: var(--color-period); }
        .fertile-day .indicator { background-color: var(--color-fertile); }
        .ovulation-day .indicator { background-color: var(--color-ovulation); }
        .current-day .indicator { background-color: #9333ea; } /* Roxo (Violet) */

        /* Efeito de Borda e Cor de Fundo para o Dia */
        .period-day { background-color: #fee2e2; }
        .fertile-day { background-color: #dbeafe; }
        .ovulation-day { background-color: #d1fae5; }
        .normal-day { background-color: #fdf2f8; }

        .current-day {
            border: 3px solid #9333ea;
        }

        /* Estilo do Botão Principal */
        #save-config-btn {
            background-color: var(--color-primary);
            transition: background-color 0.2s;
        }
        #save-config-btn:hover {
            background-color: #d946ef; /* Pink 600 */
        }
        
        /* Modal de Detalhes */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Inicia oculto */
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            transform: translateY(20px);
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsividade */
        @media (min-width: 640px) {
            .day-cell {
                height: 100px;
                padding: 8px;
            }
            .day-number {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body onload="initApp()">
    
    <!-- Card Principal -->
    <div class="card rounded-2xl overflow-hidden mb-8">
        
        <!-- Header -->
        <header class="p-6 bg-white border-b border-pink-100 text-center">
            <h1 class="text-3xl font-extrabold text-gray-800 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-pink-500"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                Ciclo Feminino
            </h1>
            <p class="text-sm text-gray-500 mt-1">Acompanhe seu ciclo, registre sintomas e entenda melhor seu corpo.</p>
        </header>

        <!-- Formulário de Configuração -->
        <div class="p-6 bg-pink-50">
            <h2 class="text-xl font-semibold mb-4 text-pink-700">Configuração do Ciclo</h2>
            <form id="cycle-config-form" class="space-y-4">
                
                <!-- Data da Última Menstruação -->
                <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                    <div class="w-full sm:w-1/2">
                        <label for="last-period-date" class="block text-sm font-medium text-gray-700 mb-1">Início da Última Menstruação</label>
                        <input type="date" id="last-period-date" required
                               class="w-full p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-150">
                    </div>
                    
                    <!-- Duração Média do Ciclo -->
                    <div class="w-full sm:w-1/2">
                        <label for="cycle-duration" class="block text-sm font-medium text-gray-700 mb-1">Duração Média do Ciclo (dias)</label>
                        <input type="number" id="cycle-duration" min="20" max="45" value="28" required
                               class="w-full p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-150">
                    </div>
                </div>

                <!-- Duração do Período -->
                <div class="w-full">
                    <label for="period-duration" class="block text-sm font-medium text-gray-700 mb-1">Duração Média do Período (dias)</label>
                    <input type="number" id="period-duration" min="3" max="10" value="5" required
                           class="w-full p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-150">
                </div>

                <button type="submit" id="save-config-btn"
                        class="w-full p-3 mt-4 rounded-lg text-white font-bold shadow-lg shadow-pink-200 hover:shadow-pink-300">
                    Salvar e Calcular Ciclo
                </button>
            </form>
        </div>

        <!-- Área de Calendário -->
        <div class="p-6">
            <div id="calendar-controls" class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="p-2 rounded-full text-pink-500 hover:bg-pink-100 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <h2 id="current-month-year" class="text-2xl font-bold text-gray-800"></h2>
                <button onclick="changeMonth(1)" class="p-2 rounded-full text-pink-500 hover:bg-pink-100 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>

            <!-- Legenda das Fases -->
            <div class="flex justify-center flex-wrap gap-4 text-sm mb-6 p-3 bg-pink-50 rounded-lg">
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--color-period);"></span>
                    <span class="text-gray-600">Menstruação</span>
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--color-fertile);"></span>
                    <span class="text-gray-600">Janela Fértil</span>
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full mr-2" style="background-color: var(--color-ovulation);"></span>
                    <span class="text-gray-600">Ovulação</span>
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full mr-2" style="background-color: #9333ea;"></span>
                    <span class="text-gray-600">Hoje</span>
                </div>
            </div>

            <!-- Container do Calendário -->
            <div id="calendar-container" class="calendar-grid rounded-xl overflow-hidden border border-pink-100">
                <!-- Dias da Semana (Headers) -->
                <div class="day-header">DOM</div>
                <div class="day-header">SEG</div>
                <div class="day-header">TER</div>
                <div class="day-header">QUA</div>
                <div class="day-header">QUI</div>
                <div class="day-header">SEX</div>
                <div class="day-header">SÁB</div>
                <!-- Células do calendário serão inseridas aqui pelo JS -->
            </div>
            
            <p id="info-message" class="text-sm text-center text-gray-500 mt-4 italic">
                A data da Última Menstruação deve ser configurada para visualizar o ciclo.
            </p>
        </div>
    </div>

    <!-- Modal de Detalhes do Dia -->
    <div id="day-modal" class="modal-overlay">
        <div class="modal-content rounded-xl p-6 w-11/12 max-w-sm opacity-0 transition-opacity">
            <h3 id="modal-date" class="text-xl font-bold mb-2 text-pink-700"></h3>
            <div id="modal-phases" class="space-y-2 mb-4">
                <!-- Detalhes do ciclo serão inseridos aqui -->
            </div>
            <p id="modal-notes" class="text-sm text-gray-500 mb-4 italic"></p>
            <button onclick="document.getElementById('day-modal').style.display='none'"
                    class="w-full p-3 rounded-lg text-white font-bold transition-colors duration-200"
                    style="background-color: #9c0c66;">
                Fechar
            </button>
        </div>
    </div>

    <!-- Assinatura da Desenvolvedora -->
    <footer class="footer-signature mt-4 text-sm text-gray-500">
        Desenvolvido por: Gabriela Neves
    </footer>

    <script>
        // Chaves para o localStorage
        const LAST_PERIOD_DATE_KEY = 'gabi_portfolio_last_period';
        const CYCLE_DURATION_KEY = 'gabi_portfolio_cycle_duration';
        const PERIOD_DURATION_KEY = 'gabi_portfolio_period_duration';
        
        // Estado da Aplicação
        let currentMonth = new Date();
        let lastPeriodDate = null;
        let cycleDuration = 28;
        let periodDuration = 5;

        // --- Funções Auxiliares de Data ---

        /**
         * Adiciona ou subtrai dias de uma data.
         * @param {Date} date - A data base.
         * @param {number} days - Número de dias para adicionar/subtrair.
         * @returns {Date} Nova data.
         */
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        /**
         * Retorna uma data formatada como YYYY-MM-DD (para input[type=date]).
         * @param {Date} date - Data a ser formatada.
         * @returns {string} Data no formato YYYY-MM-DD.
         */
        function formatDateInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        /**
         * Retorna o objeto de configurações do ciclo (datas de início/fim).
         * @param {Date} lastPeriodStart - Data de início do último período.
         * @param {number} cycleLen - Duração do ciclo (ex: 28).
         * @param {number} periodLen - Duração da menstruação (ex: 5).
         * @returns {Object} Objeto com datas chave.
         */
        function calculateCycle(lastPeriodStart, cycleLen, periodLen) {
            if (!lastPeriodStart) return null;

                // Converter para Date para operações
            const start = new Date(lastPeriodStart);

            // 1. Próximo Ciclo (Início do próximo período)
            const nextCycleStart = addDays(start, cycleLen);

            // 2. Período Atual
            const periodEnd = addDays(start, periodLen - 1);

            // 3. Ovulação (Padrão: 14 dias antes do próximo ciclo)
            const ovulationDay = addDays(nextCycleStart, -14);

            // 4. Janela Fértil (Padrão: 5 dias antes da Ovulação até 1 dia depois)
            const fertileStart = addDays(ovulationDay, -5);
            const fertileEnd = addDays(ovulationDay, 1);
            
            // 5. Ciclo Anterior (ajuda a calcular o mês atual se o período cair no mês anterior)
            const prevCycleStart = addDays(start, -cycleLen);

            return {
                start, // Início do último período (Dia 1 do Ciclo)
                periodEnd,
                nextCycleStart,
                ovulationDay,
                fertileStart,
                fertileEnd,
                prevCycleStart // Início do ciclo anterior
            };
        }

        /**
         * Determina a fase do ciclo para uma data específica.
         * @param {Date} date - Data a ser verificada.
         * @param {Object} cycleDates - Objeto de datas chave do ciclo.
         * @returns {string|null} Fase ('periodo', 'ovulacao', 'fertil', 'normal') ou null.
         */
        function getCyclePhase(date, cycleDates) {
            if (!cycleDates) return { phase: 'normal', notes: 'Configuração não definida.' };

            const dayTimestamp = date.getTime();

            // Verificar se o dia cai no período atual ou no próximo
            const isPeriod = 
                (dayTimestamp >= cycleDates.start.getTime() && dayTimestamp <= cycleDates.periodEnd.getTime()) ||
                (dayTimestamp >= cycleDates.nextCycleStart.getTime() && dayTimestamp <= addDays(cycleDates.nextCycleStart, periodDuration - 1).getTime());

            if (isPeriod) {
                return { phase: 'periodo', notes: 'Previsão de Menstruação.' };
            }

            // Verificar se o dia cai na janela fértil
            const isFertile = 
                (dayTimestamp >= cycleDates.fertileStart.getTime() && dayTimestamp <= cycleDates.fertileEnd.getTime());

            if (isFertile) {
                if (dayTimestamp === cycleDates.ovulationDay.getTime()) {
                    return { phase: 'ovulacao', notes: 'Previsão do Dia de Ovulação (Pico Fértil).' };
                }
                return { phase: 'fertil', notes: 'Previsão de Janela Fértil.' };
            }

            // Se cair no período do ciclo atual (incluindo anterior e próximo)
            const nextNextCycle = addDays(cycleDates.nextCycleStart, cycleDuration);
            const isWithinOneCycle = (dayTimestamp >= cycleDates.prevCycleStart.getTime() && dayTimestamp < nextNextCycle.getTime());
            
            if (isWithinOneCycle) {
                return { phase: 'normal', notes: 'Previsão de Fase Folicular/Lútea (Não-Fértil).' };
            }

            return { phase: 'normal', notes: 'Fora do ciclo principal de previsão.' };
        }

        // --- Funções de Renderização ---

        /**
         * Renderiza o calendário para o mês atual.
         */
        function renderCalendar() {
            if (!lastPeriodDate) {
                document.getElementById('calendar-container').innerHTML = '';
                document.getElementById('info-message').textContent = 'A data da Última Menstruação deve ser configurada para visualizar o ciclo.';
                return;
            }

            document.getElementById('info-message').textContent = `Previsão baseada em: ${formatDate(lastPeriodDate)} (Último Período) | ${cycleDuration} dias (Ciclo)`;

            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const today = new Date();
            const cycleDates = calculateCycle(lastPeriodDate, cycleDuration, periodDuration);

            // Título do Mês/Ano
            const monthName = currentMonth.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
            document.getElementById('current-month-year').textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

            const calendarContainer = document.getElementById('calendar-container');
            calendarContainer.innerHTML = `
                <div class="day-header">DOM</div>
                <div class="day-header">SEG</div>
                <div class="day-header">TER</div>
                <div class="day-header">QUA</div>
                <div class="day-header">QUI</div>
                <div class="day-header">SEX</div>
                <div class="day-header">SÁB</div>
            `;

            const firstDayOfMonth = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = firstDayOfMonth.getDay(); // 0=Domingo, 1=Segunda, etc.

            // Preenche os dias vazios do início
            for (let i = 0; i < startingDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell empty-day';
                calendarContainer.appendChild(emptyCell);
            }

            // Preenche os dias do mês
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const cell = document.createElement('div');
                const phase = getCyclePhase(date, cycleDates);
                
                // Classes de estilo
                let classes = 'day-cell normal-day rounded-lg';
                let indicator = '';

                // Verifica se é o dia atual
                if (date.toDateString() === today.toDateString()) {
                    classes += ' current-day';
                    indicator = '<span class="indicator"></span>';
                }

                if (phase.phase === 'periodo') {
                    classes += ' period-day';
                    indicator = '<span class="indicator"></span>';
                } else if (phase.phase === 'ovulacao') {
                    classes += ' ovulation-day';
                    indicator = '<span class="indicator"></span>';
                } else if (phase.phase === 'fertil') {
                    classes += ' fertile-day';
                    indicator = '<span class="indicator"></span>';
                }
                
                cell.className = classes;
                cell.dataset.date = formatDateInput(date);
                cell.dataset.phase = phase.phase;
                cell.dataset.notes = phase.notes;
                cell.innerHTML = `<span class="day-number">${day}</span>${indicator}`;

                // Adiciona evento para abrir o modal
                cell.addEventListener('click', openDayModal);

                calendarContainer.appendChild(cell);
            }
        }
        
        /**
         * Abre o modal de detalhes do dia.
         */
        function openDayModal(e) {
            const dateStr = e.currentTarget.dataset.date;
            const phase = e.currentTarget.dataset.phase;
            const notes = e.currentTarget.dataset.notes;
            const date = new Date(dateStr + 'T00:00:00'); // Garante que é meia-noite
            const modal = document.getElementById('day-modal');
            
            const phaseMap = {
                'periodo': { name: 'Menstruação', color: 'var(--color-period)' },
                'ovulacao': { name: 'Ovulação', color: 'var(--color-ovulation)' },
                'fertil': { name: 'Janela Fértil', color: 'var(--color-fertile)' },
                'normal': { name: 'Fase Folicular/Lútea', color: '#6b7280' }
            };

            const info = phaseMap[phase] || phaseMap['normal'];
            
            document.getElementById('modal-date').textContent = formatDate(date, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            document.getElementById('modal-phases').innerHTML = `
                <div class="flex items-center text-lg font-medium">
                    <span class="w-3 h-3 rounded-full mr-3" style="background-color: ${info.color};"></span>
                    <span class="text-gray-800">${info.name}</span>
                </div>
            `;
            document.getElementById('modal-notes').textContent = `Observação: ${notes}`;

            modal.style.display = 'flex';
        }

        /**
         * Formata uma data para exibição amigável.
         */
        function formatDate(date, options = { year: 'numeric', month: 'numeric', day: 'numeric' }) {
             return date.toLocaleDateString('pt-BR', options);
        }

        /**
         * Muda o mês exibido no calendário.
         * @param {number} delta - +1 para próximo mês, -1 para mês anterior.
         */
        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }


        // --- Funções de Configuração e Persistência ---
        
        /**
         * Carrega as configurações do localStorage.
         */
        function loadConfig() {
            const dateStr = localStorage.getItem(LAST_PERIOD_DATE_KEY);
            const cycleLenStr = localStorage.getItem(CYCLE_DURATION_KEY);
            const periodLenStr = localStorage.getItem(PERIOD_DURATION_KEY);

            if (dateStr) {
                // Cria a data com base no fuso horário local, garantindo a data correta
                lastPeriodDate = new Date(dateStr + 'T00:00:00');
                document.getElementById('last-period-date').value = dateStr;
            } else {
                 // Se não houver data, define a data de hoje como sugestão
                document.getElementById('last-period-date').value = formatDateInput(new Date());
            }

            if (cycleLenStr) {
                cycleDuration = parseInt(cycleLenStr, 10);
                document.getElementById('cycle-duration').value = cycleDuration;
            }
            
            if (periodLenStr) {
                periodDuration = parseInt(periodLenStr, 10);
                document.getElementById('period-duration').value = periodDuration;
            }
        }

        /**
         * Salva as configurações no localStorage e recalcula.
         */
        function saveConfig(e) {
            e.preventDefault();

            const dateInput = document.getElementById('last-period-date').value;
            const cycleLen = document.getElementById('cycle-duration').value;
            const periodLen = document.getElementById('period-duration').value;
            
            if (!dateInput || !cycleLen || !periodLen) {
                // Em um app de portfólio, podemos usar um console.error ou um toast/modal
                console.error("Por favor, preencha todos os campos.");
                return;
            }

            // Salvar no localStorage
            localStorage.setItem(LAST_PERIOD_DATE_KEY, dateInput);
            localStorage.setItem(CYCLE_DURATION_KEY, cycleLen);
            localStorage.setItem(PERIOD_DURATION_KEY, periodLen);

            // Atualizar o estado da aplicação
            lastPeriodDate = new Date(dateInput + 'T00:00:00');
            cycleDuration = parseInt(cycleLen, 10);
            periodDuration = parseInt(periodLen, 10);

            // Volta para o mês atual após salvar a configuração
            currentMonth = new Date();
            
            // Renderizar o calendário com os novos dados
            renderCalendar();
        }


        // --- Inicialização ---

        /**
         * Inicializa a aplicação ao carregar a página.
         */
        function initApp() {
            // 1. Carregar configurações do localStorage
            loadConfig();

            // 2. Anexar o listener do formulário
            document.getElementById('cycle-config-form').addEventListener('submit', saveConfig);

            // 3. Renderizar o calendário inicial
            renderCalendar();
        }
    </script>
</body>
</html>